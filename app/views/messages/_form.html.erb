<%
#locals
message ||= @message
message ||= Message.new params[:message]
to_list ||= @to_list
to_list ||= [@user] #used on someone's profile page
hide_header ||= false

unless message.new_record?
  message.subject = "RE: " + message.subject
  message.body = "\n\n\n\n\n\n\n\n\n" + message.body.gsub(/^/, '> ')
end
%>

<% unless hide_header %>
  <h1>Compose New Message</h1>
  <div id="sub_nav">
  	<%= link_to '&larr; Back to Dashboard', current_user %>  
  	<%= link_to "Inbox", messages_path unless current_user.received_messages.empty? %>
  	<%= link_to "Sent", sent_messages_path, :class=>"selected"  unless current_user.sent_messages.empty? %>
  </div>
<% end %>

<div class="thickbox_form">
	<% remote_form_for :message, :url => messages_path do |f| %>
		
		<div class="row">
			<label for="">To:</label>
			<%= f.collection_select(:receiver_id, to_list, :id, :full_name) %>	
		</div>
		
		<div class="row">
			<label for="">Subject:</label>
			<%= f.text_field :subject %>
		</div>
		
		<div class="row">
			<label for="">Body:</label>
			<%= f.text_area :body %>
		</div>
		
		<div class="row button">
		  <%= submit_tag 'Send Message', :class=>'button' %>
		</div>

	<%end %>
</div>